"use strict";(self.webpackChunkmymicroservice_7=self.webpackChunkmymicroservice_7||[]).push([[57752],{57752:(V,_,r)=>{r.d(_,{i:()=>X,D:()=>E});var c=r(30791),e=r(93953);let b=(()=>{class a{constructor(t){this.restService=t,this.apiName="AbpPermissionManagement",this.get=(i,s)=>this.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:i,providerKey:s}},{apiName:this.apiName}),this.update=(i,s,n)=>this.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:i,providerKey:s},body:n},{apiName:this.apiName})}static{this.\u0275fac=function(i){return new(i||a)(e.KVO(c.G9T))}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var m=r(39862),f=r(28793),g=r(7673),v=r(96697),C=r(25558),G=r(70980),T=r(88141),y=r(60177),d=r(89417);const M=["selectAllInThisTabsRef"],P=["selectAllInAllTabsRef"],k=()=>({size:"lg",scrollable:!1}),N=a=>({assignedCount:a});function S(a,o){if(1&a&&(e.j41(0,"h4"),e.EFF(1),e.nI1(2,"abpLocalization"),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.Lme(" ",e.bMT(2,2,"AbpPermissionManagement::Permissions")," - ",t.entityDisplayName||t.data.entityDisplayName," ")}}function A(a,o){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI("(",t.assignedCount,")")}}function x(a,o){if(1&a){const t=e.RV6();e.j41(0,"a",23),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,n=e.XpG(3);return e.Njj(n.onChangeGroup(s))})("select",function(){e.eBV(t);const s=e.XpG().$implicit,n=e.XpG(3);return e.Njj(n.setDisabled(s.permissions))}),e.j41(1,"div"),e.EFF(2),e.DNE(3,A,2,1,"span"),e.k0s()()}if(2&a){const t=o,i=e.XpG().$implicit,s=e.XpG(3);e.AVh("active",(null==s.selectedGroup?null:s.selectedGroup.name)===(null==i?null:i.name)),e.R7$(),e.AVh("font-weight-bold",t.assignedCount),e.R7$(),e.SpI(" ",null==i?null:i.displayName," "),e.R7$(),e.vxM(t.assignedCount>0?3:-1)}}function R(a,o){if(1&a&&(e.j41(0,"li",15),e.DNE(1,x,4,6,"a",22),e.k0s()),2&a){let t;const i=o.$implicit,s=e.XpG(3);e.R7$(),e.vxM((t=e.eq3(1,N,s.getAssignedCount(i.name)))?1:-1,t)}}function I(a,o){if(1&a&&(e.j41(0,"span",26),e.EFF(1),e.k0s()),2&a){const t=o.$implicit;e.R7$(),e.Lme("",t.providerName,": ",t.providerKey,"")}}function j(a,o){if(1&a&&e.Z7z(0,I,2,2,"span",26,e.Vm6),2&a){const t=e.XpG().$implicit;e.Dyx(t.grantedProviders)}}function F(a,o){if(1&a){const t=e.RV6();e.j41(0,"div",21)(1,"input",24,5),e.bIt("click",function(){const s=e.eBV(t).$implicit,n=e.sdS(2),l=e.XpG(3);return e.Njj(l.onClickCheckbox(s,n.value))}),e.k0s(),e.j41(3,"label",25),e.EFF(4),e.DNE(5,j,2,0),e.k0s()()}if(2&a){const t=o.$implicit,i=e.XpG(3);e.Y8G("ngStyle",t.style),e.R7$(),e.Y8G("checked",i.getChecked(t.name))("value",i.getChecked(t.name))("disabled",i.isGrantedByOtherProviderName(t.grantedProviders)),e.BMQ("id",t.name),e.R7$(2),e.BMQ("for",t.name),e.R7$(),e.SpI("",t.displayName," "),e.R7$(),e.vxM(i.hideBadges?-1:5)}}function B(a,o){if(1&a){const t=e.RV6();e.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"input",10,3),e.mxI("ngModelChange",function(s){e.eBV(t);const n=e.XpG(2);return e.DH7(n.selectAllTab,s)||(n.selectAllTab=s),e.Njj(s)}),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.onClickSelectAll())}),e.k0s(),e.j41(5,"label",11),e.EFF(6),e.nI1(7,"abpLocalization"),e.k0s()(),e.nrm(8,"hr",12),e.j41(9,"div",13)(10,"ul",14),e.Z7z(11,R,2,3,"li",15,e.Vm6),e.k0s()()(),e.j41(13,"div",16)(14,"div",17)(15,"div",9)(16,"input",18,4),e.mxI("ngModelChange",function(s){e.eBV(t);const n=e.XpG(2);return e.DH7(n.selectThisTab,s)||(n.selectThisTab=s),e.Njj(s)}),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.onClickSelectThisTab())}),e.k0s(),e.j41(18,"label",19),e.EFF(19),e.nI1(20,"abpLocalization"),e.k0s()(),e.nrm(21,"hr",20),e.Z7z(22,F,6,8,"div",21,e.Vm6),e.k0s()()()}if(2&a){const t=e.XpG(2);e.R7$(3),e.R50("ngModel",t.selectAllTab),e.Y8G("disabled",t.disabledSelectAllInAllTabs),e.R7$(3),e.JRh(e.bMT(7,6,"AbpPermissionManagement::SelectAllInAllTabs")),e.R7$(5),e.Dyx(t.data.groups),e.R7$(5),e.R50("ngModel",t.selectThisTab),e.Y8G("disabled",t.disableSelectAllTab),e.R7$(3),e.JRh(e.bMT(20,8,"AbpPermissionManagement::SelectAllInThisTab")),e.R7$(3),e.Dyx(t.selectedGroupPermissions)}}function D(a,o){if(1&a){const t=e.RV6();e.j41(0,"button",27),e.EFF(1),e.nI1(2,"abpLocalization"),e.k0s(),e.j41(3,"abp-button",28),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.submit())}),e.EFF(4),e.nI1(5,"abpLocalization"),e.k0s()}2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,2,"AbpIdentity::Cancel")," "),e.R7$(3),e.JRh(e.bMT(5,4,"AbpIdentity::Save")))}function $(a,o){1&a&&e.DNE(0,S,3,4,"ng-template",null,0,e.C5r)(2,B,24,10,"ng-template",null,1,e.C5r)(4,D,6,6,"ng-template",null,2,e.C5r)}let X=(()=>{class a{constructor(){this.service=(0,e.WQX)(b),this.configState=(0,e.WQX)(c.d14),this.toasterService=(0,e.WQX)(m.W9),this.hideBadges=!1,this._visible=!1,this.visibleChange=new e.bkB,this.data={groups:[],entityDisplayName:""},this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.disableSelectAllTab=!1,this.disabledSelectAllInAllTabs=!1,this.modalBusy=!1,this.selectedGroupPermissions=[],this.trackByFn=(t,i)=>i.name}get visible(){return this._visible}set visible(t){t!==this._visible&&(t?this.openModal().subscribe(()=>{this._visible=!0,this.visibleChange.emit(!0),(0,f.x)(this.selectAllInAllTabsRef.changes,this.selectAllInThisTabsRef.changes).pipe((0,v.s)(1)).subscribe(()=>{this.initModal()})}):(this.setSelectedGroup(null),this._visible=!1,this.visibleChange.emit(!1)))}getChecked(t){return(this.permissions.find(i=>i.name===t)||{isGranted:!1}).isGranted}setSelectedGroup(t){if(this.selectedGroup=t,!this.selectedGroup)return void(this.selectedGroupPermissions=[]);const i=`margin-${"rtl"===document.body.dir?"right":"left"}.px`,s=(this.data.groups.find(n=>n.name===this.selectedGroup?.name)||{}).permissions||[];this.selectedGroupPermissions=s.map(n=>({...n,style:{[i]:h(s,n)},isGranted:(this.permissions.find(l=>l.name===n.name)||{}).isGranted}))}setDisabled(t){this.disableSelectAllTab=!!t.length&&t.every(i=>i.isGranted&&i.grantedProviders?.every(s=>s.providerName!==this.providerName))}isGrantedByOtherProviderName(t){return!!t.length&&t.findIndex(i=>i.providerName!==this.providerName)>-1}onClickCheckbox(t){const{isGranted:i,grantedProviders:s}=t;i&&this.isGrantedByOtherProviderName(s)||(this.setSelectedGroup(this.selectedGroup),setTimeout(()=>{this.updatePermissionStatus(t),this.updateSelectedGroupPermissions(t),this.setParentClicked(t),this.setTabCheckboxState(),this.setGrantCheckboxState()},0))}updatePermissionStatus(t){this.permissions=this.permissions.map(i=>{const n=t.parentName===i.name,l=t.name===i.parentName;return t.name==i.name?{...i,isGranted:!i.isGranted}:l&&i.isGranted?{...i,isGranted:!1}:n&&!i.isGranted?{...i,isGranted:!0}:i})}setParentClicked(t){if(t.parentName){const i=p(this.permissions,t);if(i.length>0){const s=new Set(i.map(n=>n.name));this.permissions=this.permissions.map(n=>{let l=n.isGranted;return n.parentName===t.name&&!t.isGranted&&(l=!1),s.has(n.name)&&(l=!0),{...n,isGranted:l}})}}else this.permissions=this.permissions.map(i=>{const s=p(this.permissions,i);if(s.length>0){const n=s[s.length-1];if(n.name===t.name&&!n.isGranted)return{...i,isGranted:!1}}return i})}updateSelectedGroupPermissions(t){this.selectedGroupPermissions=this.selectedGroupPermissions.map(i=>(i.name===t.name&&(i.isGranted=!i.isGranted),i))}setTabCheckboxState(){const t=this.permissions.filter(n=>n.grantedProviders.every(l=>l.providerName===this.providerName)),i=t.filter(n=>n.isGranted),s=document.querySelector("#select-all-in-this-tabs");i.length===t.length?(s.indeterminate=!1,this.selectThisTab=!0):0===i.length?(s.indeterminate=!1,this.selectThisTab=!1):s.indeterminate=!0}setGrantCheckboxState(){const t=this.permissions.filter(n=>n.grantedProviders.every(l=>l.providerName===this.providerName)),i=t.filter(n=>n.isGranted),s=document.querySelector("#select-all-in-all-tabs");i.length===t.length?(s.indeterminate=!1,this.selectAllTab=!0):0===i.length?(s.indeterminate=!1,this.selectAllTab=!1):s.indeterminate=!0}onClickSelectThisTab(){this.selectedGroupPermissions.forEach(t=>{if(t.isGranted&&this.isGrantedByOtherProviderName(t.grantedProviders))return;const i=this.permissions.findIndex(s=>s.name===t.name);this.permissions=[...this.permissions.slice(0,i),{...this.permissions[i],isGranted:!this.selectThisTab},...this.permissions.slice(i+1)]}),this.setGrantCheckboxState()}onClickSelectAll(){this.permissions=this.permissions.map(t=>({...t,isGranted:this.isGrantedByOtherProviderName(t.grantedProviders)||!this.selectAllTab})),this.disableSelectAllTab||(this.selectThisTab=!this.selectAllTab,this.setTabCheckboxState()),this.onChangeGroup(this.selectedGroup)}onChangeGroup(t){this.setDisabled(t.permissions),this.setSelectedGroup(t),this.setTabCheckboxState()}submit(){const t=u(this.data.groups),i=this.permissions.filter(s=>(t.find(n=>n.name===s.name)||{}).isGranted!==s.isGranted).map(({name:s,isGranted:n})=>({name:s,isGranted:n}));i.length?(this.modalBusy=!0,this.service.update(this.providerName,this.providerKey,{permissions:i}).pipe((0,C.n)(()=>this.shouldFetchAppConfig()?this.configState.refreshAppState():(0,g.of)(null)),(0,G.j)(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1,this.toasterService.success("AbpUi::SavedSuccessfully")})):this.visible=!1}openModal(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.service.get(this.providerName,this.providerKey).pipe((0,T.M)(t=>{this.data=t,this.permissions=u(t.groups),this.setSelectedGroup(t.groups[0]),this.disabledSelectAllInAllTabs=this.permissions.every(i=>i.isGranted&&i.grantedProviders.every(s=>s.providerName!==this.providerName))}))}initModal(){setTimeout(()=>{this.setDisabled(this.selectedGroup?.permissions||[]),this.setTabCheckboxState(),this.setGrantCheckboxState()})}getAssignedCount(t){return this.permissions.reduce((i,s)=>s.groupName===t&&s.isGranted?i+1:i,0)}shouldFetchAppConfig(){const t=this.configState.getOne("currentUser");return"R"===this.providerName?t.roles.some(i=>i===this.providerKey):"U"===this.providerName&&t.id===this.providerKey}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["abp-permission-management"]],viewQuery:function(i,s){if(1&i&&(e.GBs(M,5),e.GBs(P,5)),2&i){let n;e.mGM(n=e.lsd())&&(s.selectAllInThisTabsRef=n),e.mGM(n=e.lsd())&&(s.selectAllInAllTabsRef=n)}},inputs:{providerName:"providerName",providerKey:"providerKey",hideBadges:"hideBadges",entityDisplayName:"entityDisplayName",visible:"visible"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:2,vars:5,consts:[["abpHeader",""],["abpBody",""],["abpFooter",""],["selectAllInAllTabsRef",""],["selectAllInThisTabsRef",""],["permissionCheckbox",""],[3,"visibleChange","visible","busy","options"],[1,"row"],[1,"col-md-4","scroll-in-modal"],[1,"form-check","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"form-check-input",3,"ngModelChange","click","ngModel","disabled"],["for","select-all-in-all-tabs",1,"form-check-label"],[1,"mt-2","mb-2"],[1,"overflow-auto"],[1,"nav","nav-pills","flex-column"],[1,"nav-item"],[1,"col-md-8","scroll-in-modal"],[1,"ps-1"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"form-check-input",3,"ngModelChange","click","ngModel","disabled"],["for","select-all-in-this-tabs",1,"form-check-label"],[1,"my-2"],[1,"form-check","mb-2",3,"ngStyle"],[1,"nav-link","pointer",3,"active"],[1,"nav-link","pointer",3,"click","select"],["type","checkbox",1,"form-check-input",3,"click","checked","value","disabled"],[1,"form-check-label"],[1,"badge","bg-primary","text-dark"],["type","button","abpClose","",1,"btn","btn-outline-primary"],["iconClass","fa fa-check",3,"click"]],template:function(i,s){1&i&&(e.j41(0,"abp-modal",6),e.mxI("visibleChange",function(l){return e.DH7(s.visible,l)||(s.visible=l),l}),e.DNE(1,$,6,0),e.k0s()),2&i&&(e.R50("visible",s.visible),e.Y8G("busy",s.modalBusy)("options",e.lJ4(4,k)),e.R7$(),e.vxM(s.data.entityDisplayName||s.entityDisplayName?1:-1))},dependencies:[y.B3,d.Zm,d.BC,d.vS,m.Qp,m.zf,m.b6,c.aM3],styles:[".overflow-scroll[_ngcontent-%COMP%]{max-height:70vh;overflow-y:scroll}.scroll-in-modal[_ngcontent-%COMP%]{overflow:auto;max-height:calc(100vh - 15rem)}"]})}}return a})();function p(a,o){const t=new Map(a.map(n=>[n.name,n]));let i=t.get(o.name)??null;const s=[];for(;i&&i.parentName;){const n=t.get(i.parentName);if(!n)break;s.push(n),i=n}return s}function h(a,o){const t=a.find(i=>i.name===o.parentName);if(t&&t.parentName){let i=20;return i+=h(a,t)}return t?20:0}function u(a){return a.reduce((o,t)=>[...o,...t.permissions.map(i=>({...i,groupName:t.name||""}))],[])}let E=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[c.Ui,m.Ts]})}}return a})()}}]);