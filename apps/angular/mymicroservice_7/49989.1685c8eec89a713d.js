"use strict";(self.webpackChunkmymicroservice_7=self.webpackChunkmymicroservice_7||[]).push([[49989],{49989:(Y,G,r)=>{r.r(G),r.d(G,{DEFAULT_GDPR_ENTITY_PROPS:()=>d,DEFAULT_GDPR_TOOLBAR_ACTIONS:()=>u,GdprActionColumnComponent:()=>g,GdprComponent:()=>m,GdprExtensionsGuard:()=>_,GdprModule:()=>B,RequestPersonalDataToolbarActionComponent:()=>f});var a=r(30791),h=r(39862),i=r(15923),t=r(93953),A=r(58780);let b=(()=>{class e{constructor(o){this.restService=o,this.apiName="Gdpr",this.deleteUserData=()=>this.restService.request({method:"DELETE",url:"/api/gdpr/requests"},{apiName:this.apiName}),this.getDownloadToken=n=>this.restService.request({method:"GET",url:"/api/gdpr/requests/download-token",params:{id:n}},{apiName:this.apiName}),this.getList=n=>this.restService.request({method:"GET",url:"/api/gdpr/requests/list",params:{userId:n.userId,sorting:n.sorting,skipCount:n.skipCount,maxResultCount:n.maxResultCount}},{apiName:this.apiName}),this.getUserData=(n,s)=>this.restService.request({method:"GET",responseType:"blob",url:`/api/gdpr/requests/data/${n}`,params:{token:s}},{apiName:this.apiName}),this.isNewRequestAllowed=()=>this.restService.request({method:"GET",url:"/api/gdpr/requests/is-request-allowed"},{apiName:this.apiName}),this.prepareUserData=()=>this.restService.request({method:"POST",url:"/api/gdpr/requests/prepare-data"},{apiName:this.apiName})}static{this.\u0275fac=function(n){return new(n||e)(t.KVO(a.G9T))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var P=r(5964),S=r(96697),v=r(96354),R=r(88141),y=r(21998),M=r(25558),U=r(7673),D=r(60177),C=r(15306);function N(e,p){1&e&&(t.j41(0,"span",1),t.EFF(1),t.nI1(2,"abpLocalization"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"AbpGdpr::Preparing")))}function I(e,p){if(1&e){const o=t.RV6();t.j41(0,"button",3),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.getUserData())}),t.EFF(1),t.nI1(2,"abpLocalization"),t.k0s()}2&e&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"AbpGdpr::Download")," "))}function E(e,p){1&e&&t.eu8(0)}function O(e,p){if(1&e&&(t.j41(0,"div",3),t.DNE(1,E,1,0,"ng-container",4),t.k0s()),2&e){t.XpG();const o=t.sdS(3),n=t.sdS(5);t.Y8G("ngbTooltip",n),t.R7$(),t.Y8G("ngTemplateOutlet",o)}}function F(e,p){if(1&e){const o=t.RV6();t.j41(0,"button",5),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.requestPersonalDataService.requestPersonalDate())}),t.EFF(2),t.nI1(3,"abpLocalization"),t.k0s()}if(2&e){const o=t.XpG();t.Y8G("disabled",t.bMT(1,2,o.requestPersonalDataService.btnDisabled$)),t.R7$(2),t.SpI(" ",t.bMT(3,4,"AbpGdpr::RequestPersonalData")," ")}}function q(e,p){1&e&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"abpLocalization"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"AbpGdpr::Volo.Abp.Gdpr:010001")))}let T=(()=>{class e{constructor(o,n){this.list=o,this.gdprRequestService=n,this.store=new a.JG$(!1),this.btnDisabled$=this.store.sliceState(s=>!s)}requestPersonalDate(){this.gdprRequestService.prepareUserData().subscribe(()=>{this.list.get(),this.checkRequestAllowed()})}checkRequestAllowed(){this.gdprRequestService.isNewRequestAllowed().subscribe(o=>{this.store.patch(o)})}static{this.\u0275fac=function(n){return new(n||e)(t.KVO(a.aGM),t.KVO(b))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac})}}return e})(),m=(()=>{class e{get currentUserId(){return this.configState.getDeep("currentUser.id")}constructor(o,n,s,c,l,J){this.list=o,this.service=n,this.configState=s,this.cdr=c,this.confirmation=l,this.requestPersonalDataService=J,this.data={items:[],totalCount:0}}ngOnInit(){this.hookToQuery(),this.requestPersonalDataService.checkRequestAllowed()}deleteData(){this.confirmation.warn("AbpGdpr::DeletePersonalDataWarning","").pipe((0,P.p)(o=>o===h.m.Status.confirm)).subscribe(()=>this.deleteUserData())}deleteUserData(){this.service.deleteUserData().subscribe(()=>{this.list.get(),this.confirmation.success("AbpGdpr::PersonalDataDeleteRequestReceived","")})}hookToQuery(){const o=this.currentUserId;this.list.hookToQuery(n=>this.service.getList({...n,userId:o})).subscribe(n=>{this.data=n,this.cdr.detectChanges()})}static{this.\u0275fac=function(n){return new(n||e)(t.rXU(a.aGM),t.rXU(b),t.rXU(a.d14),t.rXU(t.gRc),t.rXU(h.td),t.rXU(T))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["abp-gdpr"]],features:[t.Jv_([a.aGM,{provide:i.JF,useValue:"Gdpr.GdprComponent"},T])],decls:8,vars:10,consts:[[3,"title","toolbar"],[1,"alert","alert-info"],[1,"mt-4"],[1,"card"],[3,"data","recordsTotal","list"]],template:function(n,s){1&n&&(t.j41(0,"abp-page",0),t.nI1(1,"abpLocalization"),t.j41(2,"p",1),t.EFF(3),t.nI1(4,"abpLocalization"),t.k0s(),t.j41(5,"div",2)(6,"div",3),t.nrm(7,"abp-extensible-table",4),t.k0s()()()),2&n&&(t.Y8G("title",t.bMT(1,6,"AbpGdpr::PersonalData"))("toolbar",s.data.items),t.R7$(3),t.JRh(t.bMT(4,8,"AbpGdpr::PersonalDataDescription")),t.R7$(4),t.Y8G("data",s.data.items)("recordsTotal",s.data.totalCount)("list",s.list))},dependencies:[i.XY,y.H1,a.aM3],encapsulation:2})}}return e})(),g=(()=>{class e{get apiUrl(){return this.environment.getApiUrl("Gdpr")}constructor(o,n,s,c,l){this.value$=o,this.environment=n,this.gdprRequestService=s,this.subscription=c,this.abpWindowService=l,this.isReadyToDownload=!1}ngOnInit(){this.subscription.addOne(this.value$,o=>{this.isReadyToDownload=this.checkIsReadyToDownload(o.readyTime)})}getUserData(){this.value$.pipe((0,S.s)(1)).subscribe(o=>{this.checkIsReadyToDownload(o.readyTime)&&this.gdprRequestService.getDownloadToken(o.id).pipe((0,M.n)(n=>this.gdprRequestService.getUserData(o.id,n.token))).subscribe(n=>{this.abpWindowService.downloadBlob(n,"PersonalData")})})}checkIsReadyToDownload(o){return new Date(o)<new Date}static{this.\u0275fac=function(n){return new(n||e)(t.rXU(i.M_),t.rXU(a.vf1),t.rXU(b),t.rXU(a.nCQ),t.rXU(a.fPA))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["abp-gdpr-action-column"]],features:[t.Jv_([a.nCQ])],decls:3,vars:2,consts:[[1,"pointer","abp-ellipsis-inline",2,"max-width","160px"],[1,"badge","bg-warning"],["type","button",1,"btn","btn-primary"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,s){1&n&&(t.j41(0,"div",0),t.DNE(1,N,3,3,"span",1)(2,I,3,3,"button",2),t.k0s()),2&n&&(t.R7$(),t.vxM(s.isReadyToDownload?-1:1),t.R7$(),t.vxM(s.isReadyToDownload?2:-1))},dependencies:[a.aM3],encapsulation:2})}}return e})();const j=i.Fh.createMany([{type:"string",name:"action",displayName:"AbpGdpr::Action",sortable:!0,columnWidth:180,component:g,valueResolver:e=>(e=>(0,U.of)(e))(e.record)},{type:"datetime",name:"creationTime",displayName:"AbpGdpr::CreationTime",sortable:!0,columnWidth:200},{type:"datetime",name:"readyTime",displayName:"AbpGdpr::ReadyTime",sortable:!0,columnWidth:200}]);let f=(()=>{class e{constructor(o){this.requestPersonalDataService=o}static{this.\u0275fac=function(n){return new(n||e)(t.rXU(T))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["abp-request-personal-data-toolbar-action"]],decls:6,vars:4,consts:[["btnTmp",""],["tooltipTmp",""],[3,"ngbTooltip",4,"ngIf","ngIfElse"],[3,"ngbTooltip"],[4,"ngTemplateOutlet"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","disabled"]],template:function(n,s){if(1&n&&(t.DNE(0,O,2,2,"div",2),t.nI1(1,"async"),t.DNE(2,F,4,6,"ng-template",null,0,t.C5r)(4,q,3,3,"ng-template",null,1,t.C5r)),2&n){const c=t.sdS(3);t.Y8G("ngIf",t.bMT(1,2,s.requestPersonalDataService.btnDisabled$))("ngIfElse",c)}},dependencies:[D.bT,D.T3,C.md,D.Jj,a.aM3],encapsulation:2,changeDetection:0})}}return e})();const x=[...i.H_.createMany([{component:f}]),...i.KR.createMany([{text:"AbpGdpr::DeletePersonalData",action:e=>{e.getInjected(m).deleteData()},btnClass:"btn btn-sm btn-danger"}])],d={"Gdpr.GdprComponent":j},u={"Gdpr.GdprComponent":x},X=[{path:"",component:a.Cs_,canActivate:[a.W_R,a.RH_],resolve:[()=>{const e=(0,t.WQX)(t.zZn),p=e.get(i.yJ),o=e.get(d,null)||{},n=e.get(u,null)||{},s=e.get(a.d14);return(0,i.Nl)(s,"Gdpr").pipe((0,v.T)(c=>({"Gdpr.GdprComponent":c.PersonalData})),(0,i.p2)(s,"AbpGdpr"),(0,R.M)(c=>{(0,i.ah)(p.entityProps,d,c.prop,o),(0,i.xB)(p.toolbarActions,u,n)}))}],children:[{path:"",component:a.yFO,data:{replaceableComponent:{defaultComponent:m,key:"Gdpr.GdprComponent"}},title:"AbpGdpr::PersonalData"}]}];let V=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[A.iI.forChild(X),A.iI]})}}return e})(),B=(()=>{class e{static forChild(o={}){return{ngModule:e,providers:[{provide:d,useValue:o.createFormPropContributors},{provide:u,useValue:o.toolbarActionContributors}]}}static forLazy(){return new a.l37(e.forChild())}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[a.Ui,h.Ts,V,i.U9,y.wq,C.n8]})}}return e})(),_=(()=>{class e{constructor(o){this.injector=o}canActivate(){const o=this.injector.get(i.yJ),n=this.injector.get(d,null)||{},s=this.injector.get(u,null)||{},c=this.injector.get(a.d14);return(0,i.Nl)(c,"Gdpr").pipe((0,v.T)(l=>({"Gdpr.GdprComponent":l.PersonalData})),(0,i.p2)(c,"AbpGdpr"),(0,R.M)(l=>{(0,i.ah)(o.entityProps,d,l.prop,n),(0,i.xB)(o.toolbarActions,u,s)}),(0,v.T)(()=>!0))}static{this.\u0275fac=function(n){return new(n||e)(t.KVO(t.zZn))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac})}}return e})()}}]);